# -*- mode: ruby -*-
# vi: set ft=ruby :

username = ENV['USER']
home_dir = '/Users/' + username
docker_hdd= home_dir + '/VirtualBox HDDs/{{ VADO_NAME }}/docker_hdd.vdi'
pubkey = File.read("{{ VADO_SSH_PUBKEY_FILE }}")

Vagrant.configure(2) do |config|

  # The most common configuration options are documented and commented below.
  # For a complete reference, please see the online documentation at
  # https://docs.vagrantup.com.

  config.vm.box = "debian/jessie64"
  config.vm.network "private_network", ip: "{{ VADO_IP }}"

  # Mac OS X

  config.vm.synced_folder home_dir, home_dir, type: "nfs"

  # Name in Vagrant
  config.vm.define "{{ VADO_NAME }}" do |{{ VADO_NAME }}|
  end

  config.vm.provider "virtualbox" do |vb|
     vb.memory = {{ VADO_RAM }}
     # Name in VBoxManage
     vb.name = "{{ VADO_NAME }}"
     vb.customize ['createhd', '--filename', docker_hdd, '--size', 50 * 1024]
     vb.customize ['storageattach', :id, '--storagectl', 'SATA Controller', '--port', 1, '--device', 0, '--type', 'hdd', '--medium', docker_hdd]

  end

  # we need a newline after vagrant default key
  config.vm.provision "shell", inline: "echo '' >> .ssh/authorized_keys"
  config.vm.provision "shell", inline: "echo '" + pubkey + "' >> .ssh/authorized_keys"

  config.vm.provision "shell", inline: "sudo mkfs.ext4 /dev/sdb"
  config.vm.provision "shell", inline: "sudo mkdir -p /var/lib/docker"
  config.vm.provision "shell", inline: "sudo mount -t ext4 /dev/sdb /var/lib/docker"

end
